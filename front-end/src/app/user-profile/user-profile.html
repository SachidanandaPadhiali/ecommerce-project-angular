<div class="main-content">
    <!-- profile.component.html -->
    <nav class="tabs" role="tablist" aria-label="Profile sections">
        <div *ngFor="let s of sections" class="tab" role="tab" tabindex="0" [attr.aria-selected]="isActive(s.id)"
            [class.active]="isActive(s.id)" (click)="select(s.id)" (keydown.enter)="select(s.id)"
            (keydown.space)="select(s.id)">
            <div class="info-right"></div>{{ s.label }}
        </div>
    </nav>

    <section class="panel" role="tabpanel" [hidden]="!isActive('basic')">
        <h2>Basic account info</h2>
        <!-- name, email, phone, password, 2FA toggles -->
    </section>

    <section class="panel" role="tabpanel" [hidden]="!isActive('shipping')">
        <h1>Address Book</h1>
        <button class="add_address_button" (click)="showAddressForm()">Add New Address</button>
        <div id="addressList" class="address-list-container">
            <h2 style="padding-bottom: 1rem;">Your Saved Addresses</h2>

            <div *ngIf="userAddresses.length === 0" class="no-address">
                No addresses saved yet.
            </div>

            <div class="address-cards" *ngIf="userAddresses.length > 0">
                <!-- Loop through addresses and display each one -->
                <div class="address-card" *ngFor="let address of userAddresses; trackBy: trackById">
                    @if (address.default) {
                    <div class="defaultBadge">Default</div>
                    }
                    <h3>{{ address.userName }}</h3>
                    <p> {{ address.flatNo }} <br> {{ address.addressLine1 }}
                        <span *ngIf="address?.addressLine2">, {{ address.addressLine2 }}</span>
                    </p>
                    <p>{{ address.state }}, {{ address.country }} - {{ address.zipCode }}</p>
                    <p>Mobile: {{ address.phoneNumber }}</p>

                    <div class="action-buttons">
                        <button (click)="showAddressUpdateForm(address?.id ?? 0)">Edit</button>
                        <button (click)="removeAddress(address?.id ?? 0, address.userName)">Delete</button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="panel" role="tabpanel" [hidden]="!isActive('orders')">
        <h2>Order management</h2>
        <div *ngIf="isLoadingOrders">Loading orders...</div>
        <div *ngIf="userOrders$ | async as orders">
            <div *ngFor="let order of orders">
                <h3>{{ order?.id }} | {{ order?.status }} | {{ order?.total | currency:'INR':'symbol' }}</h3>
                <div class="address-card">
                    <h3>{{ order?.shippingAddress?.userName }}</h3>
                    <p> {{ order?.shippingAddress?.flatNo }} <br> {{ order?.shippingAddress?.addressLine1 }}
                        <span *ngIf="order?.shippingAddress?.addressLine2">, {{
                            order?.shippingAddress?.addressLine2
                            }}</span>
                    </p>
                    <p>{{ order?.shippingAddress?.state }}, {{ order?.shippingAddress?.country }} - {{
                        order?.shippingAddress?.zipCode }}</p>
                    <p>Mobile: {{ order?.shippingAddress?.phoneNumber }}</p>
                </div>
                <div class="order-items">
                    <div *ngFor="let item of order.items" class="order-item">
                        <img [src]="'assets/products/' + item.product.imageUrl" alt="{{item.product.imageUrl}}"
                            class="image-store" />
                        <div class="order-item-details">
                            <h3>{{ item.product.name }}</h3>
                            <p><b>Quantity :</b> {{ item.quantity }} | <b>color : </b>{{ item.product.color }}</p>
                            <h3>{{ item.price | currency:'INR':'symbol' }}</h3>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <ng-template #noOrders>
            <p>No order found.</p>
        </ng-template>
        <!-- recent orders, track, returns, invoices, re-order -->
    </section>

    <section class="panel" role="tabpanel" [hidden]="!isActive('personalization')">
        <h2>Personalization</h2>
        <!-- wishlist, sizes, preferred brands/categories, recommendations -->
    </section>
</div>